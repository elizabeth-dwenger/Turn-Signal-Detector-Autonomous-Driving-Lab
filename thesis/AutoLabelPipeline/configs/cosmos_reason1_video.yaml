# Configuration for NVIDIA Cosmos-Reason1-7B (Video Mode)

experiment:
  name: "cosmos_reason1_video_v1"
  output_dir: "results/cosmos_reason1_video/"
  random_seed: 42
  description: "NVIDIA Cosmos Reason 1 for turn signal detection - video inference mode"

data:
  input_csv: "data/tracking_data.csv"
  crop_base_dir: "/gpfs/space/projects/ml2024/"
  frame_base_dir: null
  max_sequences: null
  sequence_filter: null
  video_fps: 10

preprocessing:
  resize_resolution: [640, 480]
  normalize: true
  maintain_aspect_ratio: true
  padding_color: [0, 0, 0]
  max_sequence_length: null
  sequence_stride: 1
  enable_chunking: true
  chunk_size: 50  # ~5 seconds at 10 FPS

model:
  type: "cosmos_reason1"
  inference_mode: "video"
  # Use local path
  model_name_or_path: "/gpfs/helios/home/dwenger/models/huggingface/transformers/models--nvidia--Cosmos-Reason1-7B/snapshots/375e24000b24baed78f4618d3dd779e47cd96323"
  # OR use HuggingFace identifier (will download if not cached):
  # model_name_or_path: "nvidia/Cosmos-Reason1-7B"
  device: "cuda"
  batch_size: 1  # Process one sequence at a time
  max_new_tokens: 1500
  temperature: 0.0
  top_p: 1.0
  do_sample: false
  prompt_template_path: "data/prompts/cosmos_exp_08.txt"
  
  
  model_kwargs:
    trust_remote_code: true
    torch_dtype: "bfloat16"
    device_map: "auto"
    target_video_fps: 4
    # Add any Cosmos-specific parameters here

postprocessing:
  temporal_smoothing_enabled: false
  #smoothing_method: "mode"
  #smoothing_window_size: 5  # Smaller window since model already does temporal reasoning
  min_signal_duration_frames: 1
  max_signal_duration_frames: null
  single_image: null  # Not used in video mode

quality_control:
  random_sample_rate: 0.05
  stratified_sampling: true
  flag_both_signals: true
  flag_rapid_changes: true
  rapid_change_threshold: 3

output:
  formats: ["csv", "json"]
  include_raw_output: true  # Save model reasoning
  save_visualizations: true
  visualization_sample_rate: 0.02
  visualization_output_dir: null
  export_review_queue: true
  review_queue_format: "json"

logging:
  level: "INFO"
  log_file: null
  console_output: true
  track_metrics: true
  show_progress_bar: true
  log_frequency: 10  # Log every 10 sequences
